<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Generator</title>
  <!-- Biblioteca QR Code -->
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
</head>
<body>
<script>
    // Lista de blobs para download
    const blobsDownload = [];

    function gerarQRCode(url, texto) {
      // Criar contêiner para QR Code e texto
      const container = document.createElement('div');

      // Código QR e imagem
      const qrCode = new QRCode(container, url);
      const img = document.createElement('img');
      img.src = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(url)}&size=100x100`;
      img.alt = 'QR Code';
      container.appendChild(img);
      
      // Texto abaixo do QR Code
      const textoElement = document.createElement('p');
      textoElement.innerText = texto;
      container.appendChild(textoElement);

      // Adicionar uma linha de quebra
      document.body.appendChild(container);
      document.body.appendChild(document.createElement('hr'));

      // Converter a imagem para um blob
      fetch(img.src)
        .then(response => response.blob())
        .then(blob => {
          // Criar link de download para o blob
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = `${texto}.png`;
          link.style.display = 'none'; // Ocultar link
          document.body.appendChild(link);

          // Adicionar link à lista
          blobsDownload.push(blob);
        })
        .catch(error => console.error('Erro ao obter blob:', error));
    }

    // Obter parâmetros da URL
    const urlParams = new URLSearchParams(window.location.search);
    const urlsParam = urlParams.get('urls');
    const textosParam = urlParams.get('textos');

    // Verificar se os parâmetros estão presentes
    if (urlsParam && textosParam) {
      // Converter strings de parâmetros em arrays
      const urls = urlsParam.split(',');
      const textos = textosParam.split(',');

      // Gerar QR Codes e imagens
      urls.forEach((url, index) => {
        gerarQRCode(url, textos[index]);
      });

      // Exibir botão de download para todas as imagens
      const botaoDownload = document.createElement('button');
      botaoDownload.innerText = 'Baixar Todas as Imagens';
      botaoDownload.addEventListener('click', () => {
        // Criar um arquivo ZIP com os blobs e realizar o download
        const zip = new JSZip();
        blobsDownload.forEach((blob, index) => {
          zip.file(`${textos[index]}.png`, blob);
        });
        zip.generateAsync({ type: 'blob' })
          .then(content => {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(content);
            link.download = 'imagens.zip';
            link.click();
          })
          .catch(error => console.error('Erro ao gerar arquivo ZIP:', error));
      });
      document.body.appendChild(botaoDownload);

      // Exibir mensagem de sucesso
      const sucessoElement = document.createElement('p');
      sucessoElement.innerText = 'Imagens geradas com sucesso!';
      document.body.appendChild(sucessoElement);
    } else {
      // Exibir mensagem de erro se os parâmetros estiverem ausentes
      const erroElement = document.createElement('p');
      erroElement.innerText = 'Parâmetros "urls" e "textos" ausentes na URL.';
      document.body.appendChild(erroElement);
    }
  </script>
</body>
</html>
